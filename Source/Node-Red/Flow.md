# Node-Red #

I use Node-Red as an interface between OpenKiln and an MSSQL database and a webserver HMI to control OpenKiln. Below is the flow that you can import into Node-Red as well as information on the nodes you will need to install.

http://Node-Red:1880/Kiln
![Webserver-HMI](/Media/Node-Red/Webserver-HMI.png)

## Nodes ##

node-red-contrib-modbus
node-red-contrib-mssql-plus

## Flows ##

Here is the code for the flows.

### Kiln ###

![Kiln-Flow](/Media/Node-Red/Kiln-Flow.png)

```json
[{"id":"ffeef3d7.0b833","type":"tab","label":"Kiln","disabled":false,"info":""},{"id":"3c4c6895.145498","type":"websocket in","z":"ffeef3d7.0b833","name":"","server":"6b5cc424.028694","client":"","x":210,"y":240,"wires":[["82f30214.aac2d","bb577b28.090668"]]},{"id":"4678ba19.541e64","type":"websocket out","z":"ffeef3d7.0b833","name":"","server":"6b5cc424.028694","client":"","x":790,"y":240,"wires":[]},{"id":"568ca31c.6f2fec","type":"http in","z":"ffeef3d7.0b833","name":"","url":"/Kiln","method":"get","upload":false,"swaggerDoc":"","x":180,"y":500,"wires":[["f848fd83.f9a95"]]},{"id":"a0e62e44.9fe858","type":"http response","z":"ffeef3d7.0b833","name":"","statusCode":"","headers":{},"x":790,"y":500,"wires":[]},{"id":"f848fd83.f9a95","type":"template","z":"ffeef3d7.0b833","name":"JavaScript","field":"payload.script","fieldType":"msg","format":"javascript","syntax":"plain","template":"var Socket;\n  function init() \n  {\n    Socket = new WebSocket(\"ws://\" + window.location.hostname + \":1880/ws/Kiln\");\n    Socket.onmessage = function(event) { processReceivedCommand(event); };\n  }\n\n\n  function processReceivedCommand(evt) \n  {\n\n      var obj = JSON.parse(evt.data);\n      if (obj.topic == \"status\") {\n          document.getElementById('STATUS_CURRENT_SCHEDULE_NAME').innerHTML = obj.data.id1;\n          document.getElementById('STATUS_CURRENT_SEGMENT_NAME').innerHTML = obj.data.id2;\n          var status = \"\";\n          switch (obj.data.id3) {\n            case 0: // idle\n              status = \"IDLE\";\n              break;\n            case 1: // ramp\n              status = \"RAMP\";\n              break;\n            case 2: // soak\n              status = \"SOAK\";\n              break;\n            case 3: // hold\n              status = \"HOLD\";\n              break;\n            case 4: // init\n              status = \"INIT\";\n              break;\n            case 5: // start\n              status = \"START\";\n              break;\n          }\n          document.getElementById('STATUS_CURRENT_SEGMENT_STATUS').innerHTML = status;\n          document.getElementById('STATUS_TIME_REMAINING').innerHTML = obj.data.id4;\n          document.getElementById('STATUS_SETPOINT').innerHTML = obj.data.id5;\n          document.getElementById('STATUS_UPPER_TEMPERATURE').innerHTML = obj.data.id6;\n          document.getElementById('STATUS_LOWER_TEMPERATURE').innerHTML = obj.data.id7;\n          var modebtn = document.getElementById('MODE_BUTTON');\n          switch (obj.data.id8) {\n            case 1: \n              modebtn.innerHTML = \"AUTOMATIC\";\n              modebtn.className = \"BTN_GREEN\";\n              break;\n            case 2: \n              modebtn.innerHTML = \"MANUAL\";\n              modebtn.className = \"BTN_BLUE\";\n              break;\n            case 3: \n              modebtn.innerHTML = \"SIMULATION\";\n              modebtn.className = \"BTN_ORANGE\";\n              break;\n          }\n          if (obj.data.id9) {\n            document.getElementById('HOLD_BUTTON').style.visibility='visible';\n          } else {\n            document.getElementById('HOLD_BUTTON').style.visibility='hidden';\n          }\n          var thermalbanner = document.getElementById('THERMAL_BANNER');\n          var thermalbannertext = document.getElementById('THERMAL_BANNER_TEXT');\n          if (!obj.data.id13) {\n              if (!obj.data.id10) {\n                thermalbannertext.innerText = \"THERMAL MONITORING OK\";\n                thermalbanner.style.backgroundColor = \"yellowGreen\";\n              } else {\n                thermalbannertext.innerText = \"THERMAL MONITORING NOT OK\";\n                thermalbanner.style.backgroundColor = \"tomato\";\n              }\n          } else {\n            thermalbannertext.innerText = \"THERMAL MONITORING DISABLED\";\n            thermalbanner.style.backgroundColor = \"darkOrange\";\n          }\n          var safetybanner = document.getElementById('SAFETY_BANNER');\n          var safetybannertext = document.getElementById('SAFETY_BANNER_TEXT');\n          if (obj.data.id11) {\n            safetybannertext.innerText = \"SAFETY CIRCUIT OK\";\n            safetybanner.style.backgroundColor = \"yellowGreen\";\n          } else {\n            safetybannertext.innerText = \"SAFETY CIRCUIT NOT OK\";\n            safetybanner.style.backgroundColor = \"tomato\";\n          }\n      }\n  }\n  \n    document.getElementById('START_BUTTON').addEventListener('click', startButtonClicked);\n    function startButtonClicked()\n    {   \n      var btn = document.getElementById('START_BUTTON');\n      var btnText = btn.textContent || btn.innerText;\n      sendText('{\"topic\":\"CMD-START_PROFILE\",\"val\":\"true\"}');\n    }\n\n    document.getElementById('STOP_BUTTON').addEventListener('click', stopButtonClicked);\n    function stopButtonClicked()\n    {   \n      sendText('{\"topic\":\"CMD-STOP_PROFILE\",\"val\":\"true\"}');\n    }\n\n    document.getElementById('MODE_BUTTON').addEventListener('click', modeButtonClicked);\n    function modeButtonClicked()\n    {   \n      sendText('{\"topic\":\"CMD-CHANGE_MODE\",\"val\":\"true\"}');\n    }\n\n    document.getElementById('HOLD_BUTTON').addEventListener('click', holdButtonClicked);\n    function holdButtonClicked()\n    {   \n      sendText('{\"topic\":\"CMD-RELEASE_HOLD\",\"val\":\"true\"}');\n    }\n\n    document.getElementById('NEXT_BUTTON').addEventListener('click', nextButtonClicked);\n    function nextButtonClicked()\n    {   \n      sendText('{\"topic\":\"CMD-NEXT_SCHEDULE\",\"val\":\"true\"}');\n    }\n\n    document.getElementById('PREV_BUTTON').addEventListener('click', prevButtonClicked);\n    function prevButtonClicked()\n    {   \n      sendText('{\"topic\":\"CMD-PREV_SCHEDULE\",\"val\":\"true\"}');\n    }\n  \n    function sendText(data)\n    {\n      Socket.send(data);\n    }\n  \n    window.onload = function(e)\n    { \n      init();\n    }\n","output":"str","x":350,"y":500,"wires":[["7a62ebc7.5433f4"]]},{"id":"7a62ebc7.5433f4","type":"template","z":"ffeef3d7.0b833","name":"CSS","field":"payload.style","fieldType":"msg","format":"html","syntax":"mustache","template":":root {\n        --test-variable: true\n    }\n    body     { font-size:100%;\n              margin: 0;\n              padding: 0;\n              width: 100%;\n              height: 100%;\n              box-sizing: border-box;} \n    p        { font-size: 75%; }\n    /* https://www.bestcssbuttongenerator.com/#/4 */\n    .BTN_GREEN {\n      box-shadow: 0px 10px 14px -7px #d9fbbe;\n      background:linear-gradient(to bottom, #b8e356 5%, #a5cc52 100%);\n      background-color:#b8e356;\n      border-radius:4px;\n      border:1px solid #83c41a;\n      cursor:pointer;\n      color:#ffffff;\n      font-family:Arial;\n      font-size:13px;\n      font-weight:bold;\n      text-decoration:none;\n      text-shadow:0px 1px 0px #86ae47;\n    }\n    .BTN_GREEN:hover {\n      background:linear-gradient(to bottom, #a5cc52 5%, #b8e356 100%);\n\t    background-color:#a5cc52;\n    }\n    .BTN_RED {\n      box-shadow: 0px 10px 14px -7px #f7c5c0;\n      background:linear-gradient(to bottom, #fc8d83 5%, #e4685d 100%);\n      background-color:#fc8d83;\n      border-radius:4px;\n      border:1px solid #d83526;\n      cursor:pointer;\n      color:#ffffff;\n      font-family:Arial;\n      font-size:13px;\n      font-weight:bold;\n      text-decoration:none;\n      text-shadow:0px 1px 0px #b23e35;\n    }\n    .BTN_RED:hover {\n      background:linear-gradient(to bottom, #e4685d 5%, #fc8d83 100%);\n      background-color:#e4685d;\n    }\n    .BTN_ORANGE {\n      box-shadow: 0px 10px 14px -7px #fff6af;\n      background: linear-gradient(to bottom, #ffec64 5%, #ffab23 100%);\n      background-color: #ffec64;\n      border-radius:4px;\n      border: 1px solid #ffaa22;\n      cursor:pointer;\n      color: #ffffff;;\n      font-family:Arial;\n      font-size:13px;\n      font-weight:bold;\n      text-decoration:none;\n      text-shadow: 0px 1px 0px #ffee66;\n    }\n    .BTN_ORANGE:hover {\n      background: linear-gradient(to bottom, #ffab23 5%, #ffec64 100%);\n      background-color: #ffab23;\n    }\n    .BTN_GREY {\n      box-shadow: 0px 10px 14px -7px #ffffff;\n      background: linear-gradient(to bottom, #ededed 5%, #dfdfdf 100%);\n      background-color: #ededed;\n      border-radius:4px;\n      border: 1px solid #dcdcdc;\n      cursor:pointer;\n      color: #777777;\n      font-family:Arial;\n      font-size:13px;\n      font-weight:bold;\n      text-decoration:none;\n      text-shadow: 0px 1px 0px #ffffff;\n    }\n    .BTN_GREY:hover {\n      background: linear-gradient(to bottom, #dfdfdf 5%, #ededed 100%);\n      background-color: #dfdfdf;\n    }\n    .BTN_BLUE {\n      background:linear-gradient(to bottom, #79bbff 5%, #378de5 100%);\n      background-color:#79bbff;\n      border-radius:4px;\n      border:1px solid #337bc4;\n      cursor:pointer;\n      color:#ffffff;\n      font-family:Arial;\n      font-size:13px;\n      font-weight:bold;\n      text-decoration:none;\n      text-shadow:0px 1px 0px #528ecc;\n    }\n    .BTN_BLUE:hover {\n      background:linear-gradient(to bottom, #378de5 5%, #79bbff 100%);\n\t    background-color:#378de5;\n    }\n    .debug_raw {\n      position:absolute;\n      top: 35px;\n      left: 0px;\n    }\n    .midbuttons {\n    width:90%;\n    margin-left:5%;\n    margin-right:0px;\n    padding-left:0px;\n    padding-right:0px;\n    display:inline-block;\n    text-align:center; \n    }\n    .statuslabel {\n      width: 50%;\n      float: left;\n      text-align: right;\n      font-weight: bold;\n      color: #777777;\n    }\n    .status {\n      width: 50%;\n      float: right;\n      text-align: left;\n      text-indent: 4px;\n      color: #777777;\n    }\n    .BANNER {\n    position: fixed; \n    bottom: 0;\n    left: 0;\n    right: 0;\n    background:dimgray; /*rgba(128, 126, 126, 0.5); */\n    color: white;\n    }","output":"str","x":510,"y":500,"wires":[["c049cd49.76ee88"]]},{"id":"c049cd49.76ee88","type":"template","z":"ffeef3d7.0b833","name":"HTML","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<html>\n    <head>\n        <meta name='viewport' content='width=device-width, initial-scale=1.0'/>\n        <meta charset='utf-8'>\n        <meta name=\"apple-mobile-web-app-title\" content=\"Kiln UI\">\n        <meta name=\"apple-mobile-web-app-capable\" content=\"yes\">\n        <meta name=\"apple-mobile-web-app-status-bar-style\" content=\"translucent black\">\n        <link rel=\"apple-touch-startup-image\" href=\"/favicon-16x16.png\">\n        <link rel=\"apple-touch-icon\" sizes=\"180x180\" href=\"/apple-touch-icon.png\">\n        <link rel=\"icon\" type=\"image/png\" sizes=\"32x32\" href=\"/favicon-32x32.png\">\n        <link rel=\"icon\" type=\"image/png\" sizes=\"16x16\" href=\"/favicon-16x16.png\">\n        <link rel=\"manifest\" href=\"/site.webmanifest\">\n        <style>{{{payload.style}}}</style>\n        <title>Kiln Web UI</title>\n    </head>\n    <body>\n        <div id='main'>\n        <h2 style=\"text-align: center; color:#777777\">MAIN</h2>\n      </div>\n        <div class=\"midbuttons\" style=\"position:absolute; top:80px;\" >\n        <div>\n          <div class=\"statuslabel\">SCHEDULE: </div><div class=\"status\" id=\"STATUS_CURRENT_SCHEDULE_NAME\">loading...</div>\n        </div>\n        <div>\n          <div class=\"statuslabel\">SEGMENT: </div><div class=\"status\" id=\"STATUS_CURRENT_SEGMENT_NAME\">loading...</div>\n        </div>\n        <div>\n          <div class=\"statuslabel\">STATUS: </div><div class=\"status\" id=\"STATUS_CURRENT_SEGMENT_STATUS\">loading...</div>\n        </div>\n        <div>\n          <div class=\"statuslabel\">REMAINING: </div><div class=\"status\" id=\"STATUS_TIME_REMAINING\">loading...</div>\n        </div>\n        <div>\n          <div class=\"statuslabel\">SETPOINT: </div><div class=\"status\" id=\"STATUS_SETPOINT\">loading...</div>\n        </div>\n        <div>\n          <div class=\"statuslabel\">UPPER TEMP: </div><div class=\"status\" id=\"STATUS_UPPER_TEMPERATURE\">loading...</div>\n        </div>\n        <div>\n          <div class=\"statuslabel\">LOWER TEMP: </div><div class=\"status\" id=\"STATUS_LOWER_TEMPERATURE\">loading...</div>\n        </div>\n      </div>\n        <hr style=\"position:absolute; top:225px; width: 80%; margin-left: 10%; color: lightgray;\">\n        <div class=\"midbuttons\" style=\"position:absolute; top:250px;\" >\n            <div style=\"color:dimgray; font-weight:bold;\">Temperature Reference</div>\n            <br>\n            <div class=\"statuslabel\" style=\"width: 37.5%; font-weight: normal;\">\n                <div class=\"statuslabel\">Cone 09: </div><div class=\"status\" id=\"STATUS_CURRENT_SCHEDULE_NAME\">1688&#x2109-1706&#x2109</div>\n                <div class=\"statuslabel\">Cone 08: </div><div class=\"status\" id=\"STATUS_CURRENT_SCHEDULE_NAME\">1728&#x2109-1753&#x2109</div>\n                <div class=\"statuslabel\">Cone 07: </div><div class=\"status\" id=\"STATUS_CURRENT_SCHEDULE_NAME\">1789&#x2109-1809&#x2109</div>\n            </div>\n            <div class=\"status\" style=\"width: 62.5%;\">\n                <div class=\"statuslabel\">Cone 06: </div><div class=\"status\" id=\"STATUS_CURRENT_SCHEDULE_NAME\">1828&#x2109-1855&#x2109</div>\n                <div class=\"statuslabel\">Cone 05: </div><div class=\"status\" id=\"STATUS_CURRENT_SCHEDULE_NAME\">1888&#x2109-1911&#x2109</div>\n                <div class=\"statuslabel\">Cone 04: </div><div class=\"status\" id=\"STATUS_CURRENT_SCHEDULE_NAME\">1945&#x2109-1971&#x2109</div>\n            </div>\n        </div>\n        <hr style=\"position:absolute; top:375px; width: 80%; margin-left: 10%; color: lightgray;\">\n        <div class=\"midbuttons\" style=\"position:absolute; bottom:80px;\">\n        <div>\n          <div style=\"width:50%;float:left;\">\n            <button id='PREV_BUTTON'\n            class=\"BTN_GREY\"\n            style=\"width:100%;height:60px;\">PREV</button>\n          </div>\n          <div style=\"width:50%;float:right;\">\n            <button id='NEXT_BUTTON'\n            class=\"BTN_GREY\"\n            style=\"width:100%;height:60px;\">NEXT</button>\n          </div>\n        </div>\n        <div style=\"width:100%;\">\n          <button id='HOLD_BUTTON'\n          class=\"BTN_ORANGE\"\n          style=\"width:100%;height:60px;visibility:hidden;\">RELEASE HOLD</button>\n        </div>\n        <div style=\"width:100%;\">\n          <button id='MODE_BUTTON'\n          class=\"BTN_GREEN\"\n          style=\"width:100%;height:60px;\">AUTOMATIC</button>\n        </div>\n        <div>\n          <div style=\"width:50%;float:left;\">\n            <button id='START_BUTTON'\n            class=\"BTN_GREEN\"\n            style=\"width:100%;height:60px;\">START</button>\n          </div>\n          <div style=\"width:50%;float:right;\">\n            <button id='STOP_BUTTON'\n            class=\"BTN_RED\"\n            style=\"width:100%;height:60px;\">STOP</button>\n          </div>\n        </div>\n        <div style=\"width:100%;\">\n          <button onclick=\"window.location.href='http://SQLSERVER:3000/d/4ZgUh-MGz/kiln?orgId=1&refresh=5m&from=now-12h&to=now&kiosk';\"\n          id='SCHEDULE_BUTTON'\n          class=\"BTN_GREY\"\n          style=\"width:100%;height:60px;\">TRENDING</button>\n        </div>\n      </div>\n        <div class=\"BANNER\" style=\"right: 50%; border-right: 1px solid dimgray;\" id=\"SAFETY_BANNER\">\n        <p style=\"text-align: center;\" id=\"SAFETY_BANNER_TEXT\">SAFETY</p>\n      </div>\n        <div class=\"BANNER\" style=\"left: 50%; border-left: 1px solid dimgray;\" id=\"THERMAL_BANNER\">\n        <p style=\"text-align: center;\" id=\"THERMAL_BANNER_TEXT\">THERMAL MONITORING</p>\n      </div>\n    </body>\n    <script>{{{payload.script}}}</script>\n</html>","output":"str","x":650,"y":500,"wires":[["a0e62e44.9fe858"]]},{"id":"82f30214.aac2d","type":"function","z":"ffeef3d7.0b833","name":"Kill Session","func":"msg._session=\"\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":510,"y":240,"wires":[["4678ba19.541e64"]]},{"id":"bb577b28.090668","type":"json","z":"ffeef3d7.0b833","name":"","property":"payload","action":"","pretty":false,"x":350,"y":300,"wires":[["200515df.53ec1a"]]},{"id":"e0b32e81.c4c1e8","type":"link in","z":"ffeef3d7.0b833","name":"Input","links":["13aeb082.a20457","4c0e4289.c2abd4","3249fdf6.b46af2","8a12c19f.ca3628","20f32998.c82fc6","7e435fd9.45dfc","2788bb5d.3b68ac","7bee922.e8e246c"],"x":95,"y":620,"wires":[["185bcd52.c20a9b"]]},{"id":"9a83cf0a.176d","type":"catch","z":"ffeef3d7.0b833","name":"","scope":null,"uncaught":false,"x":60,"y":20,"wires":[["b268403a.14add8"]]},{"id":"b268403a.14add8","type":"debug","z":"ffeef3d7.0b833","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":200,"y":20,"wires":[]},{"id":"5bb01b9b.c27cd4","type":"inject","z":"ffeef3d7.0b833","name":"","props":[{"p":"payload","v":"","vt":"str"},{"p":"topic","v":"","vt":"string"}],"repeat":"2","crontab":"","once":true,"onceDelay":"5","topic":"","payload":"","payloadType":"str","x":190,"y":160,"wires":[["8e1fd5da.25b788"]]},{"id":"8e4a5bae.4c28b8","type":"json","z":"ffeef3d7.0b833","name":"","property":"payload","action":"","pretty":false,"x":490,"y":160,"wires":[["4678ba19.541e64"]]},{"id":"185bcd52.c20a9b","type":"function","z":"ffeef3d7.0b833","name":"Set Flow Variables","func":"flow.set('kiln_01.'+msg.payload.TagName, msg.payload.TagValue, 'memoryOnly');\nreturn msg;","outputs":1,"noerr":0,"x":250,"y":620,"wires":[[]]},{"id":"200515df.53ec1a","type":"function","z":"ffeef3d7.0b833","name":"Parse Incoming","func":"\nvar MB_CMD_SELECT_SCHEDULE    =  1\nvar MB_CMD_START_PROFILE     =   2\nvar MB_CMD_STOP_PROFILE     =    3\nvar MB_CMD_HOLD_RELEASE     =    4\nvar MB_CMD_THERM_OVERRIDE    =   5\nvar MB_CMD_WRITE_EEPROM      =   6\nvar MB_SCH_SEG_ENABLED      =    7\nvar MB_SCH_SEG_HOLD_EN      =    8\nvar MB_CMD_CAL_CH0_LOW      =    9\nvar MB_CMD_CAL_CH1_LOW      =    10\nvar MB_CMD_CAL_CH0_HIGH     =    11\nvar MB_CMD_CAL_CH1_HIGH     =    12\n\nvar MB_MODE = 1\nvar MB_CMD_SELECTED_SCHEDULE =   2\nvar MB_CMD_SETPOINT  =           3\nvar MB_PID_P_01    =             5\nvar MB_PID_I_01   =              7\nvar MB_PID_D_01   =              9\nvar MB_PID_P_02   =              11\nvar MB_PID_I_02   =              13\nvar MB_PID_D_02   =              15\nvar MB_SCH_NAME    =             17\nvar MB_SCH_SEG_NAME   =          25\nvar MB_SCH_SEG_SETPOINT   =      33\nvar MB_SCH_SEG_RAMP_RATE    =    35\nvar MB_SCH_SEG_SOAK_TIME    =    36\nvar MB_SCH_SEG_SELECTED   =      37\nvar MB_SCH_SELECTED     =        38\nvar MB_CAL_TEMP_ACT_CH0   =      39 \nvar MB_CAL_TEMP_ACT_CH1     =    41\n\n\nif (msg.payload.topic == \"CMD-CHANGE_MODE\") {\n    delete msg.payload;\n    var mode = flow.get(\"kiln_01.MB_MODE\",'memoryOnly');\n    var maxModes = 3;\n    if (mode>=maxModes){\n        mode=1;\n    } else {\n        mode++;\n    }\n    msg.payload = {\"type\":\"Holding-Register\",\"Data\":{\"TagName\":\"MB_MODE\",\"TagAddr\":MB_MODE,\"TagVal\":mode}}\n    return msg;\n}\n\nif (msg.payload.topic == \"CMD-START_PROFILE\") {\n    delete msg.payload;\n    msg.payload = {\"type\":\"Coil\",\"Data\":{\"TagName\":\"MB_CMD_START_PROFILE\",\"TagAddr\":MB_CMD_START_PROFILE,\"TagVal\":true}}\n    return msg;\n}\n\nif (msg.payload.topic == \"CMD-STOP_PROFILE\") {\n    delete msg.payload;\n    msg.payload = {\"type\":\"Coil\",\"Data\":{\"TagName\":\"MB_CMD_STOP_PROFILE\",\"TagAddr\":MB_CMD_STOP_PROFILE,\"TagVal\":true}}\n    return msg;\n}\n\nif (msg.payload.topic == \"CMD-RELEASE_HOLD\") {\n    delete msg.payload;\n    msg.payload = {\"type\":\"Coil\",\"Data\":{\"TagName\":\"MB_CMD_HOLD_RELEASE\",\"TagAddr\":MB_CMD_HOLD_RELEASE,\"TagVal\":true}}\n    return msg;\n}\n\nif (msg.payload.topic == \"CMD-NEXT_SCHEDULE\") {\n    delete msg.payload;\n    var currentSchedule_n = flow.get(\"kiln_01.MB_CMD_SELECTED_SCHEDULE\",'memoryOnly');\n    var maxSchedules_n = flow.get(\"kiln_01.MB_NUMBER_OF_SCHEDULES\",'memoryOnly');\n    if (currentSchedule_n>=maxSchedules_n-1){\n        currentSchedule_n=0;\n    } else {\n        currentSchedule_n++;\n    }\n    msg.payload = {\"type\":\"Holding-Register\",\"Data\":{\"TagName\":\"MB_CMD_SELECTED_SCHEDULE\",\"TagAddr\":MB_CMD_SELECTED_SCHEDULE,\"TagVal\":currentSchedule_n}}\n    return msg;\n}\n\nif (msg.payload.topic == \"CMD-PREV_SCHEDULE\") {\n    delete msg.payload;\n    var currentSchedule_p = flow.get(\"kiln_01.MB_CMD_SELECTED_SCHEDULE\",'memoryOnly');\n    var maxSchedules_p = flow.get(\"kiln_01.MB_NUMBER_OF_SCHEDULES\",'memoryOnly');\n    if (currentSchedule_p<=0){\n        currentSchedule_p=maxSchedules_p-1;\n    } else {\n        currentSchedule_p--;\n    }\n    msg.payload = {\"type\":\"Holding-Register\",\"Data\":{\"TagName\":\"MB_CMD_SELECTED_SCHEDULE\",\"TagAddr\":MB_CMD_SELECTED_SCHEDULE,\"TagVal\":currentSchedule_p}}\n    return msg;\n}\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":560,"y":300,"wires":[["a1490ecb.8a6ea8"]]},{"id":"a1490ecb.8a6ea8","type":"link out","z":"ffeef3d7.0b833","name":"Ouput","links":["295fd867.2591b8","e7d6caa4.c62a08"],"x":735,"y":300,"wires":[]},{"id":"5d062503.51e6a4","type":"http in","z":"ffeef3d7.0b833","name":"","url":"/Kiln/favicon.ico","method":"get","upload":false,"swaggerDoc":"","x":220,"y":740,"wires":[["bd382f1.815055"]]},{"id":"bd382f1.815055","type":"file in","z":"ffeef3d7.0b833","name":"","filename":"c:\\www\\Kiln\\favicon.ico","format":"","sendError":true,"x":470,"y":740,"wires":[["2e62e501.5eb8da"]]},{"id":"2e62e501.5eb8da","type":"change","z":"ffeef3d7.0b833","name":"Set Headers","rules":[{"t":"set","p":"headers","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"headers.content-type","pt":"msg","to":"image/ico","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":730,"y":740,"wires":[["8cb47971.e4eba8"]]},{"id":"8cb47971.e4eba8","type":"http response","z":"ffeef3d7.0b833","name":"","statusCode":"","headers":{},"x":890,"y":740,"wires":[]},{"id":"f9559d52.601118","type":"http in","z":"ffeef3d7.0b833","name":"","url":"/Kiln/apple-touch-icon.png","method":"get","upload":false,"swaggerDoc":"","x":190,"y":780,"wires":[["9d27a574.e0be68"]]},{"id":"9d27a574.e0be68","type":"file in","z":"ffeef3d7.0b833","name":"","filename":"c:\\www\\Kiln\\apple-touch-icon.png","format":"","sendError":true,"x":500,"y":780,"wires":[["bab54134.17afe8"]]},{"id":"bab54134.17afe8","type":"change","z":"ffeef3d7.0b833","name":"Set Headers","rules":[{"t":"set","p":"headers","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"headers.content-type","pt":"msg","to":"image/png","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":730,"y":780,"wires":[["d99821a1.d35f58"]]},{"id":"d99821a1.d35f58","type":"http response","z":"ffeef3d7.0b833","name":"","statusCode":"","headers":{},"x":890,"y":780,"wires":[]},{"id":"424aed0c.082464","type":"http in","z":"ffeef3d7.0b833","name":"","url":"/Kiln/favicon-16x16.png","method":"get","upload":false,"swaggerDoc":"","x":200,"y":820,"wires":[["dfebefee.1218"]]},{"id":"dfebefee.1218","type":"file in","z":"ffeef3d7.0b833","name":"","filename":"c:\\www\\Kiln\\favicon-16x16.png","format":"","sendError":true,"x":490,"y":820,"wires":[["18d62d96.ad1c62"]]},{"id":"18d62d96.ad1c62","type":"change","z":"ffeef3d7.0b833","name":"Set Headers","rules":[{"t":"set","p":"headers","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"headers.content-type","pt":"msg","to":"image/png","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":730,"y":820,"wires":[["4f85808f.bf0c4"]]},{"id":"4f85808f.bf0c4","type":"http response","z":"ffeef3d7.0b833","name":"","statusCode":"","headers":{},"x":890,"y":820,"wires":[]},{"id":"868f80ef.04b6d","type":"http in","z":"ffeef3d7.0b833","name":"","url":"/Kiln/favicon-32x32.png","method":"get","upload":false,"swaggerDoc":"","x":200,"y":860,"wires":[["c08f5df4.38a3d8"]]},{"id":"c08f5df4.38a3d8","type":"file in","z":"ffeef3d7.0b833","name":"","filename":"c:\\www\\Kiln\\favicon-32x32.png","format":"","sendError":true,"x":490,"y":860,"wires":[["c17ef3f5.f2d558"]]},{"id":"c17ef3f5.f2d558","type":"change","z":"ffeef3d7.0b833","name":"Set Headers","rules":[{"t":"set","p":"headers","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"headers.content-type","pt":"msg","to":"image/png","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":730,"y":860,"wires":[["fffaf1de.5d0fa8"]]},{"id":"fffaf1de.5d0fa8","type":"http response","z":"ffeef3d7.0b833","name":"","statusCode":"","headers":{},"x":890,"y":860,"wires":[]},{"id":"8dcc5795.abea1","type":"http in","z":"ffeef3d7.0b833","name":"","url":"/Kiln/site.webmanifest","method":"get","upload":false,"swaggerDoc":"","x":210,"y":900,"wires":[["62e04ac8.eb618c"]]},{"id":"62e04ac8.eb618c","type":"file in","z":"ffeef3d7.0b833","name":"","filename":"c:\\www\\Kiln\\site.webmanifest","format":"utf8","sendError":true,"encoding":"utf8","x":490,"y":900,"wires":[["92f89452.5cc878"]]},{"id":"92f89452.5cc878","type":"change","z":"ffeef3d7.0b833","name":"Set Headers","rules":[{"t":"set","p":"headers","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"headers.content-type","pt":"msg","to":"text/site-manifest","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":730,"y":900,"wires":[["13fc37f0.947868"]]},{"id":"13fc37f0.947868","type":"http response","z":"ffeef3d7.0b833","name":"","statusCode":"","headers":{},"x":890,"y":900,"wires":[]},{"id":"8e1fd5da.25b788","type":"function","z":"ffeef3d7.0b833","name":"Populate JSON","func":"\nvar id1 = flow.get(\"kiln_01.MB_STS_SCHEDULE_NAME\", 'memoryOnly');\nvar id2 = flow.get(\"kiln_01.MB_STS_SEGMENT_NAME\", 'memoryOnly');\nvar id3 = flow.get(\"kiln_01.MB_STS_SEGMENT_STATE\", 'memoryOnly');\nvar id4 = flow.get(\"kiln_01.MB_STS_REMAINING_TIME\", 'memoryOnly');\nvar id5 = flow.get(\"kiln_01.MB_CMD_SETPOINT\", 'memoryOnly');\nvar id6 = flow.get(\"kiln_01.MB_STS_TEMPERATURE_01\", 'memoryOnly');\nvar id7 = flow.get(\"kiln_01.MB_STS_TEMPERATURE_02\", 'memoryOnly');\nvar id8 = flow.get(\"kiln_01.MB_MODE\", 'memoryOnly');\nvar id9 = flow.get(\"kiln_01.MB_STS_RELEASE_REQ\", 'memoryOnly');\nvar id10 = flow.get(\"kiln_01.MB_STS_THERMAL_RUNAWAY\", 'memoryOnly');\nvar id11 = flow.get(\"kiln_01.MB_STS_SAFETY_OK\", 'memoryOnly');\nvar id12 = flow.get(\"kiln_01.MB_HEARTBEAT\", 'memoryOnly');\nvar id13 = flow.get(\"kiln_01.MB_CMD_THERM_OVERRIDE\", 'memoryOnly');\n\nmsg.payload = '{\"topic\":\"status\",\"data\":{\"id1\":\"'+ id1 +'\",\"id2\":\"'+ id2 +'\",\"id3\":'+ id3 +',\"id4\":\"'+ id4 +'\",\"id5\":'+ Math.round(id5*100)/100 +',\"id6\":'+ Math.round(id6*100)/100  +',\"id7\":'+ Math.round(id7*100)/100  +',\"id8\":'+ id8 +',\"id9\":'+ id9 +',\"id10\":'+ id10 +',\"id11\":'+ id11 +',\"id13\":'+ id13 +'}}';\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":340,"y":160,"wires":[["8e4a5bae.4c28b8"]]},{"id":"1fabdc08.7ba134","type":"inject","z":"ffeef3d7.0b833","name":"","repeat":"5","crontab":"","once":true,"onceDelay":"10","topic":"","payload":"","payloadType":"date","x":1470,"y":760,"wires":[["a605f95.837a788","5990c342.0ff954","9d56d584.178a58","e44b7e62.0ca92"]]},{"id":"ca02b507.c7dc58","type":"link out","z":"ffeef3d7.0b833","name":"","links":["409f97fe.d2701"],"x":2575,"y":2260,"wires":[]},{"id":"df1c54b4.d67d58","type":"function","z":"ffeef3d7.0b833","name":"Kiln in Hold Message","func":"var topic = \"Kiln - Status\";\nvar payload = \"The Kiln is requesting to release the hold.\";\nvar msg_out = {\"payload\":payload, \"topic\":topic};\nreturn msg_out;","outputs":1,"noerr":0,"x":2500,"y":720,"wires":[["3458eb89.96f00c"]]},{"id":"5990c342.0ff954","type":"modbus-getter","z":"ffeef3d7.0b833","name":"Kiln-Input-Status","showStatusActivities":true,"showErrors":true,"logIOActivities":false,"unitid":"","dataType":"Input","adr":"1","quantity":"8","server":"730a18e6.6782b","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":1750,"y":640,"wires":[["708c2b53.9a88a4","c414d988.bf3c6","ac5eb181.e0a8a","dbde5bea.1822c","ed8fd508.55bbb8","e8a8ea41.015aa8","87067b46.5c4b28","8c58150b.164a18","7ea67241.7a5c3c","7a2009c2.253338","f5780f21.28a24"],[]]},{"id":"a605f95.837a788","type":"modbus-getter","z":"ffeef3d7.0b833","name":"Kiln-Input-Registers","showStatusActivities":true,"showErrors":true,"logIOActivities":false,"unitid":"","dataType":"InputRegister","adr":"1","quantity":"43","server":"730a18e6.6782b","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":1720,"y":1860,"wires":[["5630fe59.d3f5e8","3549b018.055208","574b2f3f.05e5d","45abbeed.8629d","5e353fb6.af9d","39ab771e.8e70f","db5b324.098e6d","72589449.a0efd4","5bdc71ce.b679b8","a12557fa.fe532","9dbf2596.becdd","50c28297.a7fa6c","5d47abd6.ab56b4"],[]]},{"id":"573a5522.6d20cc","type":"change","z":"ffeef3d7.0b833","name":"MB_STS_TEMPERATURE_01","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.TagName","pt":"msg","to":"kiln_upper_temperature_01","tot":"str"},{"t":"set","p":"payload.TagValue","pt":"msg","to":"converted.4","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2350,"y":2260,"wires":[["d4e80fda.b439d","ca02b507.c7dc58"]]},{"id":"2fd1231a.6e2144","type":"change","z":"ffeef3d7.0b833","name":"MB_STS_TEMPERATURE_02","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.TagName","pt":"msg","to":"kiln_lower_temperature_01","tot":"str"},{"t":"set","p":"payload.TagValue","pt":"msg","to":"converted.5","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2350,"y":2280,"wires":[["ae3c24ac.5a25a8","ca02b507.c7dc58"]]},{"id":"d4e80fda.b439d","type":"rbe","z":"ffeef3d7.0b833","name":"","func":"deadbandEq","gap":"2","start":"","inout":"out","property":"payload.TagValue","x":2610,"y":2340,"wires":[[]]},{"id":"ae3c24ac.5a25a8","type":"rbe","z":"ffeef3d7.0b833","name":"","func":"deadbandEq","gap":"2","start":"","inout":"out","property":"payload.TagValue","x":2610,"y":2360,"wires":[[]]},{"id":"e3011f8a.99ae9","type":"comment","z":"ffeef3d7.0b833","name":"INPUT STATUS MAPPING","info":"\nMB_STS_SSR_01 = 1 (payload array index 0)\nMB_STS_SSR_02 = 2 (payload array index 1)\nMB_STS_RELEASE_REQ = 3 (payload array index 2)\nMB_STS_SAFETY_OK = 4 (payload array index 3)\nMB_STS_IN_PROCESS = 5 (payload array index 4)\nMB_STS_THERMAL_RUNAWAY = 6 (payload array index 5)\nMB_STS_EEPROM_WRITTEN = 7 (payload array index 6)","x":1770,"y":600,"wires":[]},{"id":"34d4fe8d.466d9a","type":"switch","z":"ffeef3d7.0b833","name":"MB_STS_RELEASE_REQ","property":"payload.2","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":2150,"y":720,"wires":[["df1c54b4.d67d58"],[]]},{"id":"e1586375.0c2ea8","type":"switch","z":"ffeef3d7.0b833","name":"MB_STS_SAFETY_OK","property":"payload.3","propertyType":"msg","rules":[{"t":"false"},{"t":"true"}],"checkall":"true","repair":false,"outputs":2,"x":2140,"y":740,"wires":[["cfca1aef.9ed1c"],[]]},{"id":"dd05e111.cb7c18","type":"switch","z":"ffeef3d7.0b833","name":"MB_STS_IN_PROCESS","property":"payload.4","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":2150,"y":760,"wires":[["47746805.a785d8"],[]]},{"id":"d511e77b.5b001","type":"switch","z":"ffeef3d7.0b833","name":"MB_STS_THERMAL_RUNAWAY","property":"payload.5","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":2170,"y":780,"wires":[["65efad7b.29e904"],[]]},{"id":"708c2b53.9a88a4","type":"rbe","z":"ffeef3d7.0b833","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload.3","x":1950,"y":740,"wires":[["e1586375.0c2ea8"]]},{"id":"c414d988.bf3c6","type":"rbe","z":"ffeef3d7.0b833","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload.4","x":1950,"y":760,"wires":[["dd05e111.cb7c18"]]},{"id":"ac5eb181.e0a8a","type":"rbe","z":"ffeef3d7.0b833","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload.5","x":1950,"y":780,"wires":[["d511e77b.5b001"]]},{"id":"cfca1aef.9ed1c","type":"function","z":"ffeef3d7.0b833","name":"Kiln Safety Not Ok","func":"var topic = \"!!! Kiln - Status !!!\";\nvar payload = \"The Kiln safety circuit in not ok!\";\nvar msg_out = {\"payload\":payload, \"topic\":topic};\nreturn msg_out;","outputs":1,"noerr":0,"x":2490,"y":740,"wires":[["3458eb89.96f00c"]]},{"id":"47746805.a785d8","type":"function","z":"ffeef3d7.0b833","name":"Kiln Schedule In Process","func":"var topic = \"Kiln - Status\";\nvar payload = \"The Kiln has started a schedule\";\nvar msg_out = {\"payload\":payload, \"topic\":topic};\nreturn msg_out;","outputs":1,"noerr":0,"x":2510,"y":760,"wires":[["3458eb89.96f00c"]]},{"id":"65efad7b.29e904","type":"function","z":"ffeef3d7.0b833","name":"Kiln Thermal Runaway","func":"var topic = \"!!! Kiln - Status !!!\";\nvar payload = \"The Kiln has detected a thermal runaway condition!\";\nvar msg_out = {\"payload\":payload, \"topic\":topic};\nreturn msg_out;","outputs":1,"noerr":0,"x":2500,"y":780,"wires":[["3458eb89.96f00c"]]},{"id":"20f32998.c82fc6","type":"link out","z":"ffeef3d7.0b833","name":"","links":["e0b32e81.c4c1e8"],"x":2415,"y":560,"wires":[]},{"id":"dbde5bea.1822c","type":"change","z":"ffeef3d7.0b833","name":"MB_STS_RELEASE_REQ","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.TagName","pt":"msg","to":"MB_STS_RELEASE_REQ","tot":"str"},{"t":"set","p":"payload.TagValue","pt":"msg","to":"responseBuffer.data.2","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2170,"y":580,"wires":[["20f32998.c82fc6"]]},{"id":"ed8fd508.55bbb8","type":"change","z":"ffeef3d7.0b833","name":"MB_STS_SAFETY_OK","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.TagName","pt":"msg","to":"MB_STS_SAFETY_OK","tot":"str"},{"t":"set","p":"payload.TagValue","pt":"msg","to":"responseBuffer.data.3","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2160,"y":600,"wires":[["20f32998.c82fc6"]]},{"id":"e8a8ea41.015aa8","type":"change","z":"ffeef3d7.0b833","name":"MB_STS_IN_PROCESS","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.TagName","pt":"msg","to":"MB_STS_IN_PROCESS","tot":"str"},{"t":"set","p":"payload.TagValue","pt":"msg","to":"responseBuffer.data.4","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2170,"y":620,"wires":[["20f32998.c82fc6"]]},{"id":"87067b46.5c4b28","type":"change","z":"ffeef3d7.0b833","name":"MB_STS_THERMAL_RUNAWAY","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.TagName","pt":"msg","to":"MB_STS_THERMAL_RUNAWAY","tot":"str"},{"t":"set","p":"payload.TagValue","pt":"msg","to":"responseBuffer.data.5","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2190,"y":640,"wires":[["20f32998.c82fc6"]]},{"id":"7e435fd9.45dfc","type":"link out","z":"ffeef3d7.0b833","name":"","links":["e0b32e81.c4c1e8"],"x":2855,"y":1840,"wires":[]},{"id":"50c28297.a7fa6c","type":"function","z":"ffeef3d7.0b833","name":"Schedule Name","func":"// need to make a copy of the buffer here\n// node-red 1.0 doesnt clone the msg object like it used to\n// https://nodered.org/blog/2019/09/13/cloning-messages\nlet bufcopy = Buffer.alloc(64) //allocate 64 bytes\nmsg.responseBuffer.buffer.copy(bufcopy)\nvar swapped = bufcopy.swap16();\nmsg.converted = swapped.toString('utf8',46,61)\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2060,"y":1980,"wires":[["213db820.5e15c8"]]},{"id":"213db820.5e15c8","type":"change","z":"ffeef3d7.0b833","name":"MB_STS_SCHEDULE_NAME","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.TagName","pt":"msg","to":"MB_STS_SCHEDULE_NAME","tot":"str"},{"t":"set","p":"payload.TagValue","pt":"msg","to":"converted","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2340,"y":1980,"wires":[["7e435fd9.45dfc"]]},{"id":"5d47abd6.ab56b4","type":"function","z":"ffeef3d7.0b833","name":"Segment Name","func":"// need to make a copy of the buffer here\n// node-red 1.0 doesnt clone the msg object like it used to\n// https://nodered.org/blog/2019/09/13/cloning-messages\nlet bufcopy = Buffer.alloc(64) //allocate 64 bytes\nmsg.responseBuffer.buffer.copy(bufcopy)\nvar swapped = bufcopy.swap16();\nmsg.converted = swapped.toString('utf8',30,45)\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2060,"y":2000,"wires":[["ed9635b7.64b17"]]},{"id":"ed9635b7.64b17","type":"change","z":"ffeef3d7.0b833","name":"MB_STS_SEGMENT_NAME","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.TagName","pt":"msg","to":"MB_STS_SEGMENT_NAME","tot":"str"},{"t":"set","p":"payload.TagValue","pt":"msg","to":"converted","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2340,"y":2000,"wires":[["7e435fd9.45dfc"]]},{"id":"9d56d584.178a58","type":"modbus-getter","z":"ffeef3d7.0b833","name":"Kiln-Holding-Registers","showStatusActivities":true,"showErrors":true,"logIOActivities":false,"unitid":"","dataType":"HoldingRegister","adr":"1","quantity":"42","server":"730a18e6.6782b","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":1740,"y":1280,"wires":[["a2ac6497.d59858","611f837f.70bb7c","e8da40f3.937bf8","fecdb4de.e769","899aa2c.69637e","296fe8c9.fc3a2","648798f2.d3c528","2d4711a7.53613e","9892b4d6.97b95","b60f58c2.b8e4","5057c7b3.16d39"],[]]},{"id":"e44b7e62.0ca92","type":"modbus-getter","z":"ffeef3d7.0b833","name":"Kiln-Coils","showStatusActivities":true,"showErrors":true,"logIOActivities":false,"unitid":"","dataType":"Coil","adr":"1","quantity":"12","server":"730a18e6.6782b","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":1740,"y":220,"wires":[["28a1b668.39729a","b795e27.367d62","2f3fe305.349a34","345a4ba4.08da7c","44f38ca0.7928ac","a99c9f78.46e138","f6a1a58f.17d81","f8340953.ca2db","f3dcc34b.e32458","a8ec2594.1c7e3","1b6316fa.6915d1","a7efb2b9.6235d"],[]]},{"id":"8c58150b.164a18","type":"change","z":"ffeef3d7.0b833","name":"MB_STS_EEPROM_WRITTEN","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.TagName","pt":"msg","to":"MB_STS_EEPROM_WRITTEN","tot":"str"},{"t":"set","p":"payload.TagValue","pt":"msg","to":"responseBuffer.data.6","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2190,"y":660,"wires":[["20f32998.c82fc6"]]},{"id":"7a2009c2.253338","type":"change","z":"ffeef3d7.0b833","name":"MB_STS_SSR_01","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.TagName","pt":"msg","to":"MB_STS_SSR_01","tot":"str"},{"t":"set","p":"payload.TagValue","pt":"msg","to":"responseBuffer.data.0","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2150,"y":540,"wires":[["20f32998.c82fc6"]]},{"id":"7ea67241.7a5c3c","type":"change","z":"ffeef3d7.0b833","name":"MB_STS_SSR_02","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.TagName","pt":"msg","to":"MB_STS_SSR_02","tot":"str"},{"t":"set","p":"payload.TagValue","pt":"msg","to":"responseBuffer.data.1","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2150,"y":560,"wires":[["20f32998.c82fc6"]]},{"id":"28a1b668.39729a","type":"change","z":"ffeef3d7.0b833","name":"MB_CMD_SELECT_SCHEDULE","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.TagName","pt":"msg","to":"MB_CMD_SELECT_SCHEDULE","tot":"str"},{"t":"set","p":"payload.TagValue","pt":"msg","to":"responseBuffer.data.0","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2130,"y":100,"wires":[["2788bb5d.3b68ac"]]},{"id":"b795e27.367d62","type":"change","z":"ffeef3d7.0b833","name":"MB_CMD_START_PROFILE","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.TagName","pt":"msg","to":"MB_CMD_START_PROFILE","tot":"str"},{"t":"set","p":"payload.TagValue","pt":"msg","to":"responseBuffer.data.1","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2120,"y":120,"wires":[["2788bb5d.3b68ac"]]},{"id":"2f3fe305.349a34","type":"change","z":"ffeef3d7.0b833","name":"MB_CMD_STOP_PROFILE","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.TagName","pt":"msg","to":"MB_CMD_STOP_PROFILE","tot":"str"},{"t":"set","p":"payload.TagValue","pt":"msg","to":"responseBuffer.data.2","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2120,"y":140,"wires":[["2788bb5d.3b68ac"]]},{"id":"345a4ba4.08da7c","type":"change","z":"ffeef3d7.0b833","name":"MB_CMD_HOLD_RELEASE","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.TagName","pt":"msg","to":"MB_CMD_HOLD_RELEASE","tot":"str"},{"t":"set","p":"payload.TagValue","pt":"msg","to":"responseBuffer.data.3","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2120,"y":160,"wires":[["2788bb5d.3b68ac"]]},{"id":"44f38ca0.7928ac","type":"change","z":"ffeef3d7.0b833","name":"MB_CMD_THERM_OVERRIDE","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.TagName","pt":"msg","to":"MB_CMD_THERM_OVERRIDE","tot":"str"},{"t":"set","p":"payload.TagValue","pt":"msg","to":"responseBuffer.data.4","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2130,"y":180,"wires":[["2788bb5d.3b68ac"]]},{"id":"a99c9f78.46e138","type":"change","z":"ffeef3d7.0b833","name":"MB_CMD_WRITE_EEPROM","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.TagName","pt":"msg","to":"MB_CMD_WRITE_EEPROM","tot":"str"},{"t":"set","p":"payload.TagValue","pt":"msg","to":"responseBuffer.data.5","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2120,"y":200,"wires":[["2788bb5d.3b68ac"]]},{"id":"f6a1a58f.17d81","type":"change","z":"ffeef3d7.0b833","name":"MB_SCH_SEG_ENABLED","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.TagName","pt":"msg","to":"MB_SCH_SEG_ENABLED","tot":"str"},{"t":"set","p":"payload.TagValue","pt":"msg","to":"responseBuffer.data.6","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2120,"y":220,"wires":[["2788bb5d.3b68ac"]]},{"id":"f8340953.ca2db","type":"change","z":"ffeef3d7.0b833","name":"MB_SCH_SEG_HOLD_EN","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.TagName","pt":"msg","to":"MB_SCH_SEG_HOLD_EN","tot":"str"},{"t":"set","p":"payload.TagValue","pt":"msg","to":"responseBuffer.data.7","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2120,"y":240,"wires":[["2788bb5d.3b68ac"]]},{"id":"f3dcc34b.e32458","type":"change","z":"ffeef3d7.0b833","name":"MB_CMD_CAL_CH0_LOW","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.TagName","pt":"msg","to":"MB_CMD_CAL_CH0_LOW","tot":"str"},{"t":"set","p":"payload.TagValue","pt":"msg","to":"responseBuffer.data.8","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2120,"y":260,"wires":[["2788bb5d.3b68ac"]]},{"id":"a8ec2594.1c7e3","type":"change","z":"ffeef3d7.0b833","name":"MB_CMD_CAL_CH1_LOW","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.TagName","pt":"msg","to":"MB_CMD_CAL_CH1_LOW","tot":"str"},{"t":"set","p":"payload.TagValue","pt":"msg","to":"responseBuffer.data.9","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2120,"y":280,"wires":[["2788bb5d.3b68ac"]]},{"id":"1b6316fa.6915d1","type":"change","z":"ffeef3d7.0b833","name":"MB_CMD_CAL_CH0_HIGH","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.TagName","pt":"msg","to":"MB_CMD_CAL_CH0_HIGH","tot":"str"},{"t":"set","p":"payload.TagValue","pt":"msg","to":"responseBuffer.data.10","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2120,"y":300,"wires":[["2788bb5d.3b68ac"]]},{"id":"a7efb2b9.6235d","type":"change","z":"ffeef3d7.0b833","name":"MB_CMD_CAL_CH1_HIGH","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.TagName","pt":"msg","to":"MB_CMD_CAL_CH1_HIGH","tot":"str"},{"t":"set","p":"payload.TagValue","pt":"msg","to":"responseBuffer.data.11","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2120,"y":320,"wires":[["2788bb5d.3b68ac"]]},{"id":"2788bb5d.3b68ac","type":"link out","z":"ffeef3d7.0b833","name":"","links":["e0b32e81.c4c1e8"],"x":2435,"y":200,"wires":[]},{"id":"39ab771e.8e70f","type":"change","z":"ffeef3d7.0b833","name":"MB_HEARTBEAT","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.TagName","pt":"msg","to":"MB_HEARTBEAT","tot":"str"},{"t":"set","p":"payload.TagValue","pt":"msg","to":"responseBuffer.data[0]","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2310,"y":1700,"wires":[["7e435fd9.45dfc"]]},{"id":"5bdc71ce.b679b8","type":"change","z":"ffeef3d7.0b833","name":"MB_STS_REMAINING_TIME_H","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.TagName","pt":"msg","to":"MB_STS_REMAINING_TIME_H","tot":"str"},{"t":"set","p":"payload.TagValue","pt":"msg","to":"responseBuffer.data.1","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2350,"y":1720,"wires":[[]]},{"id":"72589449.a0efd4","type":"change","z":"ffeef3d7.0b833","name":"MB_STS_REMAINING_TIME_M","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.TagName","pt":"msg","to":"MB_STS_REMAINING_TIME_M","tot":"str"},{"t":"set","p":"payload.TagValue","pt":"msg","to":"responseBuffer.data.2","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2350,"y":1740,"wires":[["5532c118.6db988"]]},{"id":"db5b324.098e6d","type":"change","z":"ffeef3d7.0b833","name":"MB_STS_REMAINING_TIME_S","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.TagName","pt":"msg","to":"MB_STS_REMAINING_TIME_S","tot":"str"},{"t":"set","p":"payload.TagValue","pt":"msg","to":"responseBuffer.data.3","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2350,"y":1760,"wires":[[]]},{"id":"5fc93014.8e06b","type":"change","z":"ffeef3d7.0b833","name":"MB_STS_PID_01_OUTPUT","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.TagName","pt":"msg","to":"MB_STS_PID_01_OUTPUT","tot":"str"},{"t":"set","p":"payload.TagValue","pt":"msg","to":"converted.6","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2340,"y":1840,"wires":[["7e435fd9.45dfc"]]},{"id":"a35482c2.3d58c","type":"change","z":"ffeef3d7.0b833","name":"MB_STS_PID_02_OUTPUT","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.TagName","pt":"msg","to":"MB_STS_PID_02_OUTPUT","tot":"str"},{"t":"set","p":"payload.TagValue","pt":"msg","to":"converted.7","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2340,"y":1860,"wires":[["7e435fd9.45dfc"]]},{"id":"3549b018.055208","type":"change","z":"ffeef3d7.0b833","name":"MB_NUMBER_OF_SCHEDULES","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.TagName","pt":"msg","to":"MB_NUMBER_OF_SCHEDULES","tot":"str"},{"t":"set","p":"payload.TagValue","pt":"msg","to":"responseBuffer.data.12","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2350,"y":1900,"wires":[["7e435fd9.45dfc"]]},{"id":"574b2f3f.05e5d","type":"change","z":"ffeef3d7.0b833","name":"MB_NUMBER_OF_SEGMENTS","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.TagName","pt":"msg","to":"MB_NUMBER_OF_SEGMENTS","tot":"str"},{"t":"set","p":"payload.TagValue","pt":"msg","to":"responseBuffer.data.13","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2350,"y":1920,"wires":[["7e435fd9.45dfc"]]},{"id":"45abbeed.8629d","type":"change","z":"ffeef3d7.0b833","name":"MB_STS_SEGMENT_STATE","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.TagName","pt":"msg","to":"MB_STS_SEGMENT_STATE","tot":"str"},{"t":"set","p":"payload.TagValue","pt":"msg","to":"responseBuffer.data.14","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2340,"y":1940,"wires":[["7e435fd9.45dfc"]]},{"id":"cef5760d.0a7dc","type":"change","z":"ffeef3d7.0b833","name":"MB_STS_TEMP_01_RAW","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.TagName","pt":"msg","to":"MB_STS_TEMP_01_RAW","tot":"str"},{"t":"set","p":"payload.TagValue","pt":"msg","to":"converted.2","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2340,"y":2040,"wires":[["7e435fd9.45dfc"]]},{"id":"2ef95a2d.f6bf06","type":"change","z":"ffeef3d7.0b833","name":"MB_STS_TEMP_02_RAW","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.TagName","pt":"msg","to":"MB_STS_TEMP_02_RAW","tot":"str"},{"t":"set","p":"payload.TagValue","pt":"msg","to":"converted.3","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2340,"y":2060,"wires":[["7e435fd9.45dfc"]]},{"id":"5630fe59.d3f5e8","type":"function","z":"ffeef3d7.0b833","name":"UINT16_TO_FLOAT","func":"var arrSize = 8;\nvar start = 4;\nlet arr = new Array(arrSize);\nvar i;\nfor (i=0;i<arrSize;i++) {\n   arr.push(msg.payload[i+start]); \n}\n\nvar ui16 = new Uint16Array(arr);\nvar fl32 = new Float32Array(ui16.buffer, ui16.byteOffset, ui16.byteLength / Float32Array.BYTES_PER_ELEMENT);\nmsg.converted = fl32;\nreturn msg;","outputs":1,"noerr":0,"x":2060,"y":1840,"wires":[["573a5522.6d20cc","2fd1231a.6e2144","5fc93014.8e06b","a35482c2.3d58c","c6df583b.b004d","43abdc58.f2ca2c"]]},{"id":"5e353fb6.af9d","type":"function","z":"ffeef3d7.0b833","name":"UINT16_TO_FLOAT","func":"var arrSize = 4;\nvar start = 31;\nlet arr = new Array(arrSize);\nvar i;\nfor (i=0;i<arrSize;i++) {\n   arr.push(msg.payload[i+start]); \n}\n\nvar ui16 = new Uint16Array(arr);\nvar fl32 = new Float32Array(ui16.buffer, ui16.byteOffset, ui16.byteLength / Float32Array.BYTES_PER_ELEMENT);\nmsg.converted = fl32;\nreturn msg;","outputs":1,"noerr":0,"x":2060,"y":2060,"wires":[["cef5760d.0a7dc","2ef95a2d.f6bf06"]]},{"id":"a2ac6497.d59858","type":"function","z":"ffeef3d7.0b833","name":"UINT16_TO_FLOAT","func":"var arrSize = 14;\nvar start = 2;\nlet arr = new Array(arrSize);\nvar i;\nfor (i=0;i<arrSize;i++) {\n   arr.push(msg.payload[i+start]); \n}\n\nvar ui16 = new Uint16Array(arr);\nvar fl32 = new Float32Array(ui16.buffer, ui16.byteOffset, ui16.byteLength / Float32Array.BYTES_PER_ELEMENT);\nmsg.converted = fl32;\nreturn msg;","outputs":1,"noerr":0,"x":2130,"y":1160,"wires":[["16b8cd4c.29d9eb","c533bae2.c6dc58","59d974a8.4bcafc","92be95d8.26ed88","db08847.1f59cf8","48e3463b.aed0c","c647577a.e44d7"]]},{"id":"611f837f.70bb7c","type":"change","z":"ffeef3d7.0b833","name":"MB_MODE","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.TagName","pt":"msg","to":"MB_MODE","tot":"str"},{"t":"set","p":"payload.TagValue","pt":"msg","to":"responseBuffer.data.0","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2350,"y":1020,"wires":[["7bee922.e8e246c"]]},{"id":"e8da40f3.937bf8","type":"change","z":"ffeef3d7.0b833","name":"MB_CMD_SELECTED_SCHEDULE","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.TagName","pt":"msg","to":"MB_CMD_SELECTED_SCHEDULE","tot":"str"},{"t":"set","p":"payload.TagValue","pt":"msg","to":"responseBuffer.data.1","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2420,"y":1040,"wires":[["7bee922.e8e246c"]]},{"id":"16b8cd4c.29d9eb","type":"change","z":"ffeef3d7.0b833","name":"MB_CMD_SETPOINT","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.TagName","pt":"msg","to":"MB_CMD_SETPOINT","tot":"str"},{"t":"set","p":"payload.TagValue","pt":"msg","to":"converted.7","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2380,"y":1080,"wires":[["7bee922.e8e246c"]]},{"id":"c533bae2.c6dc58","type":"change","z":"ffeef3d7.0b833","name":"MB_PID_P_01","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.TagName","pt":"msg","to":"MB_PID_P_01","tot":"str"},{"t":"set","p":"payload.TagValue","pt":"msg","to":"converted.8","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2360,"y":1100,"wires":[["7bee922.e8e246c"]]},{"id":"59d974a8.4bcafc","type":"change","z":"ffeef3d7.0b833","name":"MB_PID_I_01","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.TagName","pt":"msg","to":"MB_PID_I_01","tot":"str"},{"t":"set","p":"payload.TagValue","pt":"msg","to":"converted.9","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2360,"y":1120,"wires":[["7bee922.e8e246c"]]},{"id":"92be95d8.26ed88","type":"change","z":"ffeef3d7.0b833","name":"MB_PID_D_01","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.TagName","pt":"msg","to":"MB_PID_D_01","tot":"str"},{"t":"set","p":"payload.TagValue","pt":"msg","to":"converted.10","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2360,"y":1140,"wires":[["7bee922.e8e246c"]]},{"id":"db08847.1f59cf8","type":"change","z":"ffeef3d7.0b833","name":"MB_PID_P_02","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.TagName","pt":"msg","to":"MB_PID_P_02","tot":"str"},{"t":"set","p":"payload.TagValue","pt":"msg","to":"converted.11","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2360,"y":1160,"wires":[["7bee922.e8e246c"]]},{"id":"48e3463b.aed0c","type":"change","z":"ffeef3d7.0b833","name":"MB_PID_I_02","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.TagName","pt":"msg","to":"MB_PID_I_02","tot":"str"},{"t":"set","p":"payload.TagValue","pt":"msg","to":"converted.12","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2360,"y":1180,"wires":[["7bee922.e8e246c"]]},{"id":"c647577a.e44d7","type":"change","z":"ffeef3d7.0b833","name":"MB_PID_D_02","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.TagName","pt":"msg","to":"MB_PID_D_02","tot":"str"},{"t":"set","p":"payload.TagValue","pt":"msg","to":"converted.13","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2360,"y":1200,"wires":[["7bee922.e8e246c"]]},{"id":"7bee922.e8e246c","type":"link out","z":"ffeef3d7.0b833","name":"","links":["e0b32e81.c4c1e8"],"x":2755,"y":1180,"wires":[]},{"id":"fecdb4de.e769","type":"function","z":"ffeef3d7.0b833","name":"Schedule Name","func":"// need to make a copy of the buffer here\n// node-red 1.0 doesnt clone the msg object like it used to\n// https://nodered.org/blog/2019/09/13/cloning-messages\nlet bufcopy = Buffer.alloc(64) //allocate 64 bytes\nmsg.responseBuffer.buffer.copy(bufcopy)\nvar swapped = bufcopy.swap16();\nmsg.converted = swapped.toString('utf8',32,47)\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2140,"y":1240,"wires":[["50d418d9.b41ae"]]},{"id":"50d418d9.b41ae","type":"change","z":"ffeef3d7.0b833","name":"MB_SCH_NAME","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.TagName","pt":"msg","to":"MB_SCH_NAME","tot":"str"},{"t":"set","p":"payload.TagValue","pt":"msg","to":"converted","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2370,"y":1240,"wires":[["7bee922.e8e246c"]]},{"id":"899aa2c.69637e","type":"function","z":"ffeef3d7.0b833","name":"Segment Name","func":"// need to make a copy of the buffer here\n// node-red 1.0 doesnt clone the msg object like it used to\n// https://nodered.org/blog/2019/09/13/cloning-messages\nlet bufcopy = Buffer.alloc(64) //allocate 64 bytes\nmsg.responseBuffer.buffer.copy(bufcopy)\nvar swapped = bufcopy.swap16();\nmsg.converted = swapped.toString('utf8',48,63)\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2140,"y":1260,"wires":[["472f60fc.b863b8"]]},{"id":"472f60fc.b863b8","type":"change","z":"ffeef3d7.0b833","name":"MB_SCH_SEG_NAME","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.TagName","pt":"msg","to":"MB_SCH_SEG_NAME","tot":"str"},{"t":"set","p":"payload.TagValue","pt":"msg","to":"converted","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2380,"y":1260,"wires":[["7bee922.e8e246c"]]},{"id":"296fe8c9.fc3a2","type":"function","z":"ffeef3d7.0b833","name":"UINT16_TO_FLOAT","func":"var arrSize = 2;\nvar start = 32;\nlet arr = new Array(arrSize);\nvar i;\nfor (i=0;i<arrSize;i++) {\n   arr.push(msg.payload[i+start]); \n}\n\nvar ui16 = new Uint16Array(arr);\nvar fl32 = new Float32Array(ui16.buffer, ui16.byteOffset, ui16.byteLength / Float32Array.BYTES_PER_ELEMENT);\nmsg.converted = fl32;\nreturn msg;","outputs":1,"noerr":0,"x":2150,"y":1300,"wires":[["ab2622ae.2542d8"]]},{"id":"ab2622ae.2542d8","type":"change","z":"ffeef3d7.0b833","name":"MB_SCH_SEG_SETPOINT","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.TagName","pt":"msg","to":"MB_SCH_SEG_SETPOINT","tot":"str"},{"t":"set","p":"payload.TagValue","pt":"msg","to":"converted.1","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2400,"y":1300,"wires":[["7bee922.e8e246c"]]},{"id":"648798f2.d3c528","type":"change","z":"ffeef3d7.0b833","name":"MB_SCH_SEG_RAMP_RATE","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.TagName","pt":"msg","to":"MB_SCH_SEG_RAMP_RATE","tot":"str"},{"t":"set","p":"payload.TagValue","pt":"msg","to":"responseBuffer.data.34","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2400,"y":1340,"wires":[["7bee922.e8e246c"]]},{"id":"2d4711a7.53613e","type":"change","z":"ffeef3d7.0b833","name":"MB_SCH_SEG_SOAK_TIME","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.TagName","pt":"msg","to":"MB_SCH_SEG_SOAK_TIME","tot":"str"},{"t":"set","p":"payload.TagValue","pt":"msg","to":"responseBuffer.data.35","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2400,"y":1360,"wires":[["7bee922.e8e246c"]]},{"id":"9892b4d6.97b95","type":"change","z":"ffeef3d7.0b833","name":"MB_SCH_SEG_SELECTED","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.TagName","pt":"msg","to":"MB_SCH_SEG_SELECTED","tot":"str"},{"t":"set","p":"payload.TagValue","pt":"msg","to":"responseBuffer.data.36","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2400,"y":1380,"wires":[["7bee922.e8e246c"]]},{"id":"b60f58c2.b8e4","type":"change","z":"ffeef3d7.0b833","name":"MB_SCH_SELECTED","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.TagName","pt":"msg","to":"MB_SCH_SELECTED","tot":"str"},{"t":"set","p":"payload.TagValue","pt":"msg","to":"responseBuffer.data.37","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2380,"y":1400,"wires":[["7bee922.e8e246c"]]},{"id":"5057c7b3.16d39","type":"function","z":"ffeef3d7.0b833","name":"UINT16_TO_FLOAT","func":"var arrSize = 4;\nvar start = 38;\nlet arr = new Array(arrSize);\nvar i;\nfor (i=0;i<arrSize;i++) {\n   arr.push(msg.payload[i+start]); \n}\n\nvar ui16 = new Uint16Array(arr);\nvar fl32 = new Float32Array(ui16.buffer, ui16.byteOffset, ui16.byteLength / Float32Array.BYTES_PER_ELEMENT);\nmsg.converted = fl32;\nreturn msg;","outputs":1,"noerr":0,"x":2150,"y":1440,"wires":[["506e8d88.194adc","e96c7528.578d98"]]},{"id":"506e8d88.194adc","type":"change","z":"ffeef3d7.0b833","name":"MB_CAL_TEMP_ACT_CH0","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.TagName","pt":"msg","to":"MB_CAL_TEMP_ACT_CH0","tot":"str"},{"t":"set","p":"payload.TagValue","pt":"msg","to":"converted.2","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2400,"y":1440,"wires":[["7bee922.e8e246c"]]},{"id":"e96c7528.578d98","type":"change","z":"ffeef3d7.0b833","name":"MB_CAL_TEMP_ACT_CH1","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.TagName","pt":"msg","to":"MB_CAL_TEMP_ACT_CH1","tot":"str"},{"t":"set","p":"payload.TagValue","pt":"msg","to":"converted.3","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2400,"y":1460,"wires":[["7bee922.e8e246c"]]},{"id":"e4cea850.79a928","type":"function","z":"ffeef3d7.0b833","name":"Concat Time","func":"\nvar hour = 0;\nif (msg.responseBuffer.data[1] < 10) {\n    hour = '0' + msg.responseBuffer.data[1];\n} else {\n    hour = msg.responseBuffer.data[1];\n}\n\nvar min = 0;\nif (msg.responseBuffer.data[2] < 10) {\n    min = '0' + msg.responseBuffer.data[2];\n} else {\n    min = msg.responseBuffer.data[2];\n}\n\nvar sec = 0;\nif (msg.responseBuffer.data[3] < 10) {\n    sec = '0' + msg.responseBuffer.data[3];\n} else {\n    sec = msg.responseBuffer.data[3];\n}\n\ndelete msg.payload;\nmsg.payload = {\"TagName\":\"MB_STS_REMAINING_TIME\",\"TagValue\": hour + ':' + min + ':' + sec};\n\nreturn msg;","outputs":1,"noerr":0,"x":2730,"y":1740,"wires":[["7e435fd9.45dfc"]]},{"id":"c6df583b.b004d","type":"change","z":"ffeef3d7.0b833","name":"MB_STS_TEMPERATURE_01","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.TagName","pt":"msg","to":"MB_STS_TEMPERATURE_01","tot":"str"},{"t":"set","p":"payload.TagValue","pt":"msg","to":"converted.4","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2350,"y":1780,"wires":[["43f8ad1b.934784"]]},{"id":"43abdc58.f2ca2c","type":"change","z":"ffeef3d7.0b833","name":"MB_STS_TEMPERATURE_02","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.TagName","pt":"msg","to":"MB_STS_TEMPERATURE_02","tot":"str"},{"t":"set","p":"payload.TagValue","pt":"msg","to":"converted.5","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2350,"y":1800,"wires":[["79851e77.3edd2"]]},{"id":"e7d6caa4.c62a08","type":"link in","z":"ffeef3d7.0b833","name":"Input - Kiln","links":["a1490ecb.8a6ea8"],"x":1680,"y":2580,"wires":[["2dd12b9a.c87e84"]]},{"id":"2dd12b9a.c87e84","type":"switch","z":"ffeef3d7.0b833","name":"","property":"payload.type","propertyType":"msg","rules":[{"t":"eq","v":"Coil","vt":"str"},{"t":"eq","v":"Holding-Register","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1880,"y":2580,"wires":[["923ff923.3b2d5"],["98ece36b.08bd28"]]},{"id":"a0a58c06.37de8","type":"modbus-flex-write","z":"ffeef3d7.0b833","name":"Kiln","showStatusActivities":true,"showErrors":true,"server":"730a18e6.6782b","emptyMsgOnFail":false,"keepMsgProperties":false,"x":2470,"y":2580,"wires":[[],[]]},{"id":"2743beaf.0dce5a","type":"function","z":"ffeef3d7.0b833","name":"Set Message","func":"\nmsg.payload = { value: msg.payload.Data.TagVal, 'fc': msg.payload.Data.fc, 'unitid': 1, 'address': msg.payload.Data.TagAddr , 'quantity': 1 };\n\nreturn msg;","outputs":1,"noerr":0,"x":2290,"y":2580,"wires":[["a0a58c06.37de8"]]},{"id":"98ece36b.08bd28","type":"change","z":"ffeef3d7.0b833","name":"Holding Registers","rules":[{"t":"set","p":"payload.Data.fc","pt":"msg","to":"6","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":2050,"y":2600,"wires":[["2743beaf.0dce5a"]]},{"id":"923ff923.3b2d5","type":"change","z":"ffeef3d7.0b833","name":"Coils","rules":[{"t":"set","p":"payload.Data.fc","pt":"msg","to":"5","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":2010,"y":2560,"wires":[["2743beaf.0dce5a"]]},{"id":"5532c118.6db988","type":"rbe","z":"ffeef3d7.0b833","name":"","func":"deadbandEq","gap":"50%","start":"","inout":"out","property":"payload.TagValue","x":2570,"y":1740,"wires":[["e4cea850.79a928"]]},{"id":"43f8ad1b.934784","type":"rbe","z":"ffeef3d7.0b833","name":"","func":"deadbandEq","gap":"2","start":"","inout":"out","property":"payload.TagValue","x":2570,"y":1780,"wires":[["7e435fd9.45dfc"]]},{"id":"79851e77.3edd2","type":"rbe","z":"ffeef3d7.0b833","name":"","func":"deadbandEq","gap":"2","start":"","inout":"out","property":"payload.TagValue","x":2570,"y":1800,"wires":[["7e435fd9.45dfc"]]},{"id":"a12557fa.fe532","type":"function","z":"ffeef3d7.0b833","name":"UINT16_TO_FLOAT","func":"var arrSize = 4;\nvar start = 35;\nlet arr = new Array(arrSize);\nvar i;\nfor (i=0;i<arrSize;i++) {\n   arr.push(msg.payload[i+start]); \n}\n\nvar ui16 = new Uint16Array(arr);\nvar fl32 = new Float32Array(ui16.buffer, ui16.byteOffset, ui16.byteLength / Float32Array.BYTES_PER_ELEMENT);\nmsg.converted = fl32;\nreturn msg;","outputs":1,"noerr":0,"x":2060,"y":2180,"wires":[["85f51bc1.722b68","cc4ab9ca.0f14f"]]},{"id":"85f51bc1.722b68","type":"change","z":"ffeef3d7.0b833","name":"MB_STS_MEAS_RATE_CH0","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.TagName","pt":"msg","to":"MB_STS_MEAS_RATE_CH0","tot":"str"},{"t":"set","p":"payload.TagValue","pt":"msg","to":"converted.2","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2340,"y":2160,"wires":[[]]},{"id":"cc4ab9ca.0f14f","type":"change","z":"ffeef3d7.0b833","name":"MB_STS_MEAS_RATE_CH1","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.TagName","pt":"msg","to":"MB_STS_MEAS_RATE_CH1","tot":"str"},{"t":"set","p":"payload.TagValue","pt":"msg","to":"converted.3","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2340,"y":2180,"wires":[[]]},{"id":"9dbf2596.becdd","type":"function","z":"ffeef3d7.0b833","name":"UINT16_TO_UINT32","func":"var arrSize = 4;\nvar start = 35;\nlet arr = new Array(arrSize);\nvar i;\nfor (i=0;i<arrSize;i++) {\n   arr.push(msg.payload[i+start]); \n}\n\nvar ui16 = new Uint16Array(arr);\n\nvar ui32 = new Uint32Array(ui16.buffer, ui16.byteOffset, ui16.byteLength / Uint32Array.BYTES_PER_ELEMENT)\n\nmsg.converted = ui32;\nreturn msg;","outputs":1,"noerr":0,"x":2060,"y":2120,"wires":[["f11a93e0.7a3418","9ccf0305.836c98"]]},{"id":"f11a93e0.7a3418","type":"change","z":"ffeef3d7.0b833","name":"MB_STS_RUNAWAY_TEMP_T","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.TagName","pt":"msg","to":"MB_STS_RUNAWAY_TEMP_T","tot":"str"},{"t":"set","p":"payload.TagValue","pt":"msg","to":"converted.2","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2350,"y":2100,"wires":[[]]},{"id":"9ccf0305.836c98","type":"change","z":"ffeef3d7.0b833","name":"MB_STS_RUNAWAY_RATE_T","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.TagName","pt":"msg","to":"MB_STS_RUNAWAY_RATE_T","tot":"str"},{"t":"set","p":"payload.TagValue","pt":"msg","to":"converted.3","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2350,"y":2120,"wires":[[]]},{"id":"f5780f21.28a24","type":"rbe","z":"ffeef3d7.0b833","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload.2","x":1950,"y":720,"wires":[["34d4fe8d.466d9a"]]},{"id":"3458eb89.96f00c","type":"e-mail","z":"ffeef3d7.0b833","server":"smtp.gmail.com","port":"465","secure":true,"tls":false,"name":"address@mail.com","dname":"GMail","x":2810,"y":740,"wires":[]},{"id":"6b5cc424.028694","type":"websocket-listener","z":"","path":"/ws/Kiln","wholemsg":"false"},{"id":"730a18e6.6782b","type":"modbus-client","z":"","name":"","clienttype":"tcp","bufferCommands":true,"stateLogEnabled":false,"queueLogEnabled":false,"tcpHost":"10.0.3.164","tcpPort":"502","tcpType":"DEFAULT","serialPort":"/dev/ttyUSB","serialType":"RTU-BUFFERD","serialBaudrate":"9600","serialDatabits":"8","serialStopbits":"1","serialParity":"none","serialConnectionDelay":"100","unit_id":"1","commandDelay":"1","clientTimeout":"1000","reconnectOnTimeout":true,"reconnectTimeout":"2000","parallelUnitIdsAllowed":true}]
```

### MSSQL ###

Note that you will need to set up a MSSQL database to use this feature. It is not required to operate OpenKiln. I just use it to view the historical data of the run.

![MSSQL-Flow](/Media/Node-Red/MSSQL-Flow.png)

```json
[{"id":"60588744.915d88","type":"tab","label":"MSSQL","disabled":false,"info":""},{"id":"e6fd1c3f.d8a5f8","type":"MSSQL","z":"60588744.915d88","mssqlCN":"95b735d0.157558","name":"SQLServer","outField":"payload","returnType":0,"throwErrors":1,"query":"\nDECLARE\t@return_value int\n\nEXEC\t@return_value = [dbo].[InsertHistoricalData]\n\t\t@TAGNAME = N'{{{payload.TagName}}}',\n\t\t@VALUE = N'{{{payload.TagValue}}}'\n\nSELECT\t'Return Value' = @return_value\n","x":450,"y":220,"wires":[["ff05aa43.aaafd8"]]},{"id":"ff05aa43.aaafd8","type":"debug","z":"60588744.915d88","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":590,"y":220,"wires":[]},{"id":"8516d584.c26958","type":"comment","z":"60588744.915d88","name":"Send Data","info":"","x":180,"y":120,"wires":[]},{"id":"5bb94556.f70244","type":"catch","z":"60588744.915d88","name":"","scope":null,"uncaught":false,"x":60,"y":20,"wires":[["953c4515.dd00c"]]},{"id":"953c4515.dd00c","type":"debug","z":"60588744.915d88","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":190,"y":20,"wires":[]},{"id":"dd1f338c.a3ca18","type":"link in","z":"60588744.915d88","name":"MSSQL Send Data","links":["ca02b507.c7dc58"],"x":195,"y":220,"wires":[["bbe911a1.4b4fc8"]]},{"id":"bbe911a1.4b4fc8","type":"switch","z":"60588744.915d88","name":"","property":"payload.TagValue","propertyType":"msg","rules":[{"t":"neq","v":"NO_RESPONSE","vt":"str"},{"t":"eq","v":"NO_RESPONSE","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":290,"y":220,"wires":[["e6fd1c3f.d8a5f8"],[]]},{"id":"95b735d0.157558","type":"MSSQL-CN","z":"","tdsVersion":"7_4","name":"SQLServer","server":"SQLSERVER","port":"1433","encyption":false,"database":"automation_historical","useUTC":false,"connectTimeout":"15000","requestTimeout":"15000","cancelTimeout":"5000","pool":"5","parseJSON":false}]
```